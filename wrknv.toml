project_name = "wrknv"
version = "0.1.0"
[tools]
terraform = ["1.11.x", "1.13.x"]
tofu = ["1.9.x", "1.10.x"]

[tools.bao]
version = "2.1.0"

[profiles]

[profiles.dev]
terraform = ["1.11.x", "1.13.x"]
tofu = ["1.9.x", "1.10.x"]
bao = "2.1.0"

[workenv]
auto_install = true
use_cache = true
cache_ttl = "7d"
log_level = "WARNING"
container_runtime = "docker"
container_registry = "ghcr.io"

[env]


# ==============================================================================
# Tasks
# ==============================================================================

[tasks]
typecheck = "mypy src/"
build = "uv build"

[tasks.setup]
_default = "uv sync"
pre-commit = """
if ! command -v pre-commit >/dev/null 2>&1; then
  echo "Installing pre-commit..."
  uv pip install pre-commit
fi
if [ ! -f .pre-commit-config.yaml ]; then
  echo "Installing standard pre-commit config..."
  if [ -f ../ci-tooling/configs/pre-commit-config.yaml ]; then
    cp ../ci-tooling/configs/pre-commit-config.yaml .pre-commit-config.yaml
  else
    echo "Warning: ci-tooling/configs/pre-commit-config.yaml not found"
    echo "Please ensure ci-tooling is cloned at ../ci-tooling"
    exit 1
  fi
fi
pre-commit install
pre-commit install --hook-type commit-msg
echo "âœ“ Pre-commit hooks installed"

"""

[tasks.lint]
_default = "ruff check ."
fix = "ruff check . --fix"

[tasks.format]
_default = "ruff format ."
check = "ruff format . --check"

[tasks.test]
_default = "pytest"
unit = "pytest -m unit"
cli = "pytest tests/cli/ -v"
fast = "pytest tests/ -x"
parallel = "pytest -n auto"
verbose = "pytest -vvv"
integration = "pytest -m integration"

[tasks.test.coverage]
run = "pytest tests/ --cov=src/wrknv --cov-report=term-missing"
description = "Run tests with coverage"
_default = "pytest --cov=src --cov-report=html --cov-report=term-missing"
xml = "pytest --cov=src --cov-report=xml --cov-report=term"

[tasks.hello]
run = """
echo 'ðŸŽ‰â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
echo '   Welcome to wrknv - The Work Environment Manager!'
echo '   Your friendly neighborhood task runner is ready to work! ðŸš€'
echo 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ðŸŽ‰'
echo ''
echo 'ðŸ’¡ Pro tip: Try running:'
echo '   â€¢ wrknv tasks          (see all available tasks)'
echo '   â€¢ wrknv run test       (run the tests)'
echo '   â€¢ wrknv run lint       (check code quality)'
echo ''
echo 'âœ¨ May your builds be swift and your tests be green! âœ¨'


"""
description = "A delightfully enthusiastic greeting from wrknv"

[tasks.quality]
run = ["lint", "typecheck"]
description = "Run all quality checks"
_default = ["lint", "typecheck"]
all = ["format.check", "lint", "typecheck", "test"]

[tasks.ci]
run = ["quality", "test"]
description = "Complete CI pipeline"
_default = ["quality", "test", "build"]
test = ["test.parallel", "test.coverage"]
quality = ["format.check", "lint", "typecheck"]

[tasks.mutation]
_default = "mutmut run"
results = "mutmut results"
browse = "mutmut browse"
clean = "rm -rf .mutmut-cache html/"

[tasks.pkg]
install = "uv pip install -e ."
uninstall = "uv pip uninstall -y $(grep '^name = ' pyproject.toml | cut -d'\"' -f2)"
lock = "uv lock"
version = "cat VERSION 2>/dev/null || grep '^version = ' pyproject.toml | cut -d'\"' -f2"

[tasks.clean]
run = """
rm -rf build/ dist/ *.egg-info .pytest_cache .mypy_cache .ruff_cache .hypothesis htmlcov/ .coverage .mutmut-cache site/
find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
find . -type f -name '*.pyc' -delete 2>/dev/null || true
find . -type f -name '*.pyo' -delete 2>/dev/null || true

"""

[tasks.docs]
_default = "mkdocs serve"
setup = "python -c \"from provide.foundry.config import extract_base_mkdocs; from pathlib import Path; extract_base_mkdocs(Path('.'))\""
build = "mkdocs build"
serve = "mkdocs serve"
clean = "rm -rf site .provide"

[tasks.docs.links]
_default = "lychee --offline --verbose --no-progress './docs/**/*.md' './src/**/*.md' './README.md' './.github/**/*.md' './CONTRIBUTING.md' 2>&1 | grep -v 'INFO'"
check = "lychee --offline --verbose --no-progress './docs/**/*.md' './src/**/*.md' './README.md' './.github/**/*.md' './CONTRIBUTING.md' 2>&1 | grep -v 'INFO'"
local = "lychee --offline --verbose --no-progress './docs/**/*.md' './src/**/*.md' './README.md' './.github/**/*.md' './CONTRIBUTING.md' 2>&1 | grep -v 'INFO'"
external = "lychee --verbose --no-progress './docs/**/*.md' './src/**/*.md' './README.md' './.github/**/*.md' './CONTRIBUTING.md'"

[tasks.dev]
setup = "uv sync"
test = "pytest -n auto"
check = "ruff format . && ruff check . && mypy src/"
