name: Test Setup Action

on:
  pull_request:
    paths:
      - '.github/actions/setup-wrknv/**'
      - '.github/workflows/test-setup-action.yml'
  workflow_dispatch:

jobs:
  test-setup-pypi:
    name: Test Setup from PyPI
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6
      
      - name: Setup wrknv from PyPI
        uses: ./.github/actions/setup-wrknv
        with:
          python-version: '3.11'
          install-from: 'pypi'
          version: 'latest'
      
      - name: Verify installation
        run: |
          wrknv --version
          wrknv --help
          wrknv status

  test-setup-local:
    name: Test Setup from Local
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-24.04, macos-15, windows-2022]
        python: ['3.11', '3.12', '3.13']
    steps:
      - uses: actions/checkout@v6
      
      - name: Setup wrknv from local
        uses: ./.github/actions/setup-wrknv
        with:
          python-version: ${{ matrix.python }}
          install-from: 'local'
      
      - name: Test with tools
        run: |
          wrknv --version
          wrknv setup --check
          wrknv config path

  test-setup-with-config:
    name: Test Setup with Configuration
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6
      
      - name: Create test configuration
        run: |
          cat > test-wrknv.toml << EOF
          project_name = "test-project"
          version = "1.0.0"
          
          [tools]
          tofu = { version = "1.8.0" }
          EOF
      
      - name: Setup wrknv with config
        uses: ./.github/actions/setup-wrknv
        with:
          install-from: 'local'
          config-file: 'test-wrknv.toml'
          tofu-version: '1.8.0'
      
      - name: Verify tools
        run: |
          wrknv status
          which tofu || echo "tofu not found"

  test-setup-with-profile:
    name: Test Setup with Profile
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6
      
      - name: Setup wrknv
        uses: ./.github/actions/setup-wrknv
        with:
          install-from: 'local'
      
      - name: Create and load profile
        run: |
          # Create a test profile
          wrknv profile save test-profile --force || true
          wrknv profile list
          
          # Test loading (even if it doesn't have tools)
          wrknv profile load test-profile || true